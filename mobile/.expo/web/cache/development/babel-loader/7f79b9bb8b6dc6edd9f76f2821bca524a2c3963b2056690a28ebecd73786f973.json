{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport { api } from \"../services/api\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport var AuthContext = createContext({});\nexport var AuthContextProvider = function AuthContextProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(),\n    _useState2 = _slicedToArray(_useState, 2),\n    authData = _useState2[0],\n    setAuth = _useState2[1];\n  useEffect(function () {\n    loadFromStorage();\n  }, []);\n  function loadFromStorage() {\n    var auth;\n    return _regeneratorRuntime.async(function loadFromStorage$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@AuthData\"));\n          case 2:\n            auth = _context.sent;\n            if (auth) {\n              setAuth(JSON.parse(auth));\n            }\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n  function signIn(email, senha) {\n    var response, _response$data, token, user;\n    return _regeneratorRuntime.async(function signIn$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(api.post(\"/users/login\", {\n              email: email,\n              senha: senha\n            }));\n          case 3:\n            response = _context2.sent;\n            _response$data = response.data, token = _response$data.token, user = _response$data.user;\n            console.log(user);\n            if (user) {\n              setAuth(user);\n            }\n            AsyncStorage.setItem(\"@AuthData\", JSON.stringify(user));\n            _context2.next = 13;\n            break;\n          case 10:\n            _context2.prev = 10;\n            _context2.t0 = _context2[\"catch\"](0);\n            Alert.alert(\"Credenciais erradas\");\n          case 13:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 10]], Promise);\n  }\n  function signOut() {\n    return _regeneratorRuntime.async(function signOut$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            setAuth(undefined);\n            AsyncStorage.removeItem(\"@AuthData\");\n            return _context3.abrupt(\"return\");\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n  return _jsx(AuthContext.Provider, {\n    value: {\n      authData: authData,\n      signIn: signIn,\n      signOut: signOut\n    },\n    children: children\n  });\n};\nexport function useAuth() {\n  var context = useContext(AuthContext);\n  return context;\n}","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","AsyncStorage","Alert","api","jsx","_jsx","AuthContext","AuthContextProvider","_ref","children","_useState","_useState2","_slicedToArray","authData","setAuth","loadFromStorage","auth","_regeneratorRuntime","async","loadFromStorage$","_context","prev","next","awrap","getItem","sent","JSON","parse","stop","Promise","signIn","email","senha","response","_response$data","token","user","signIn$","_context2","post","data","console","log","setItem","stringify","t0","alert","signOut","signOut$","_context3","undefined","removeItem","abrupt","Provider","value","useAuth","context"],"sources":["C:/Users/Guilherme/Documents/MakeYourGO/mobile/src/contexts/AuthContext.tsx"],"sourcesContent":["/* eslint-disable no-useless-return */\r\n/* eslint-disable indent */\r\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { authService } from \"../services/authService\";\r\nimport { Alert } from \"react-native\";\r\nimport { api } from \"../services/api\";\r\n\r\nexport interface AuthData {\r\n  id: string;\r\n  name: string;\r\n  email: string;\r\n  senha: string;\r\n  created_at?: Date;\r\n}\r\n\r\ninterface AuthContextData {\r\n  authData?: AuthData;\r\n  signIn: (email: string, senha: string) => Promise<AuthData>;\r\n  signOut: () => Promise<void>;\r\n}\r\n\r\nexport const AuthContext = createContext<AuthContextData>(\r\n  {} as AuthContextData\r\n);\r\n\r\nexport const AuthContextProvider: React.FC = ({ children }) => {\r\n  const [authData, setAuth] = useState<AuthData>();\r\n\r\n  useEffect(() => {\r\n    loadFromStorage();\r\n  }, []);\r\n\r\n  async function loadFromStorage() {\r\n    const auth = await AsyncStorage.getItem(\"@AuthData\");\r\n    if (auth) {\r\n      setAuth(JSON.parse(auth) as AuthData);\r\n    }\r\n  }\r\n\r\n  async function signIn(email: string, senha: string): Promise<AuthData> {\r\n    try {\r\n      const response = await api.post(\"/users/login\", {\r\n        email,\r\n        senha,\r\n      });\r\n\r\n      const { token, user } = response.data;\r\n      console.log(user);\r\n\r\n      if (user) {\r\n        setAuth(user);\r\n      }\r\n\r\n      AsyncStorage.setItem(\"@AuthData\", JSON.stringify(user));\r\n    } catch (error) {\r\n      Alert.alert(\"Credenciais erradas\");\r\n    }\r\n  }\r\n\r\n  async function signOut(): Promise<void> {\r\n    setAuth(undefined);\r\n    AsyncStorage.removeItem(\"@AuthData\");\r\n\r\n    return;\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ authData, signIn, signOut }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport function useAuth() {\r\n  const context = useContext(AuthContext);\r\n  return context;\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}